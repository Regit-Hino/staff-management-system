# スタッフ管理システム - プロジェクト情報

## バージョン情報
**Current Version: v2.0.0** (2025年6月13日)

### バージョン履歴
- **v1.0.0** (初期リリース) - スタッフ管理基本機能
- **v1.1.0** - モーダルシステム実装、編集機能追加
- **v1.2.0** - シフト管理画面実装
- **v2.0.0** - フィルター機能、デザイン統一、レスポンシブ対応

## プロジェクト概要
oplus系のシフト管理システムのスタッフ管理機能を忠実に再現したWebアプリケーション。
TDD（Test-Driven Development）ベースでの開発を行い、UI/UXの完全な再現を目指している。

## 主要機能
### 実装済み機能
1. **スタッフ一覧表示**
   - ドラッグ&ドロップによる行の並び替え
   - 各スタッフの基本情報表示（名前、ふりがな、メモ、社員番号、タグ、時給、交通費、月最大出勤数、連絡先、権限、シフト表）
   - スタッフ数のカウント表示
   - 管理者権限者の視覚的識別（シアン色表示）

2. **スタッフ招待システム**
   - 7種類の招待方法（スタッフ登録、仮スタッフ登録、リンク、QRコード、CSVインポート、SMS、OCRダウンロード）
   - モーダルダイアログによる各招待方法の設定

3. **スタッフ編集機能**
   - 3点リーダーメニューからの編集・削除
   - スタッフ名クリックでの編集画面遷移
   - フルスクリーン編集画面（モーダルではない）
   - 個人情報と企業情報の2カラム編成
   - 詳細なフォームバリデーション
   - 権限管理（編集画面でのみ変更可能、一覧表示は読み取り専用）

4. **シフト管理システム**
   - 横長スクロール可能カレンダー
   - 日・週・月・カスタム表示切り替え（レスポンシブ対応）
   - 今日の日付の黄色い背景ハイライト表示
   - スタッフ管理データとの連携
   - カスタム期間選択モーダル（ドラッグ&ドロップ期間選択）
   - タブナビゲーション（シフト、業務、カウント、制出、労務）
   - 内部カレンダースクロール機能
   - 管理者権限者の視覚的識別（シアン色表示）

5. **フィルター機能**
   - フィルターモーダル（出勤者のみ・確定のみ）
   - 出勤者のみフィルター: 表示期間内にシフトがないスタッフを非表示
   - フィルター状態の保持とリアルタイム適用

6. **デザイン統一**
   - ゴシック体フォント（割当人数・人時・人件費・日付）
   - スタッフ管理とシフト管理画面間のデザイン統一
   - フォントサイズの統一（13px基準）

7. **データ永続化**
   - localStorage/sessionStorageを使用したクライアントサイド保存
   - スタッフ情報の編集・保存・読み込み

## ファイル構成
```
/Users/hinotakafumi/Desktop/claudecode/Oplusコピー/
├── index.html              # メインのスタッフ一覧画面
├── staff-edit.html         # スタッフ編集画面
├── shift-management.html   # シフト管理画面
├── css/
│   ├── staff-management.css  # メイン画面のスタイル
│   ├── staff-edit.css       # 編集画面専用スタイル
│   └── shift-management.css # シフト管理画面専用スタイル
├── js/
│   ├── staff-management.js  # メイン画面のJavaScript
│   ├── staff-edit.js        # 編集画面専用JavaScript
│   └── shift-management.js  # シフト管理画面専用JavaScript
├── test-action.html         # デバッグ用テストページ
└── CLAUDE.md               # このファイル
```

## 技術仕様
- **HTML5** with semantic structure
- **CSS3** with Flexbox/Grid layouts
- **Vanilla JavaScript** (フレームワーク不使用)
- **FontAwesome 6.0.0** for icons
- **localStorage/sessionStorage** for data persistence

## データ構造
### スタッフデータ (localStorage: 'staffManagementData')
```javascript
{
  id: string,
  name: string,
  furigana: string,
  email: string,
  phone: string,
  role: string, // '管理者'|'スタッフ'|'シフト編集者'|'閲覧者'
  isTemp: boolean,
  employeeId: string,
  hourlyWage: string,
  transport: string,
  maxMonthly: string,
  monthlyBreak: string,
  weekMin: string,
  weekMax: string,
  monthMin: string,
  monthMax: string,
  joinYear: string,
  joinMonth: string,
  joinDay: string,
  weeklyDays: string,
  connectionId: string,
  memo: string,
  tag: string,
  applyAll: boolean
}
```

### 編集用データ (localStorage: 'allStaffData')
```javascript
{
  [staffId]: staffData,
  ...
}
```

### 編集中スタッフID (sessionStorage: 'editingStaffId')
```javascript
string // スタッフのID
```

### フィルター状態（グローバル変数）
```javascript
let attendeeOnlyFilter = false; // 出勤者のみフィルター
let confirmedOnlyFilter = false; // 確定のみフィルター（未実装）
```

### シフトデータ（サンプル）
```javascript
// 特定日のシフト有無判定
const shiftData = {
  '日野 真文': [{ date: '6/2', day: 1 }], // 月曜日
  'Regit 高木': [{ date: '6/3', day: 2 }], // 火曜日
  '上原': [{ date: '6/2', day: 1 }], // 月曜日
  // タロウ、一雄: シフトなし
};
```

## UI/UX設計方針
1. **oplus完全準拠** - 提供されたスクリーンショットに基づく忠実な再現
2. **レスポンシブ対応** - モバイル・タブレット・デスクトップでの適切な表示
3. **直感的操作** - ドラッグ&ドロップ、モーダル、ドロップダウンによる操作性
4. **一貫性のあるデザイン** - カラーパレット、フォント、余白の統一

## 重要な実装ポイント
### イベント管理
- **イベント委譲**を使用した3点リーダーボタンの管理
- 重複イベントリスナーの防止
- DOMの動的変更に対応した確実なイベント設定
- フィルターボタンの直接設定による確実な動作保証

### データ同期
- 編集画面と一覧画面間での確実なデータ同期
- localStorage/sessionStorageの適切な使い分け
- データ更新後のUI反映
- フィルター適用時のスタッフリストとカレンダーの同期更新

### レスポンシブデザイン
- 日・週・月表示に応じたカレンダー列幅の動的変更
- 内部スクロール機能による適切な画面サイズ制御
- フォントサイズ統一によるデザイン一貫性

### モーダル管理
- 複数モーダル（カスタム期間選択・フィルター）の適切な制御
- 背景クリック・×ボタンでの閉じる機能
- フィルター状態の保持と復元

### エラーハンドリング
- フォームバリデーション（必須項目、時間形式、日付妥当性）
- データ保存失敗時の適切なエラーメッセージ
- コンソールログによるデバッグ情報
- /ultrathinkによる根本原因分析

## 既知の問題・改善点
1. **確定のみフィルター** - フィルターモーダル内に項目はあるが機能未実装
2. **シフトデータ拡張** - 現在はハードコードされたサンプルデータのみ
3. **シフト編集機能** - シフトセルのクリック編集機能が未実装
4. **実際のシフト管理** - シフトの追加・編集・削除機能が未実装

## 開発履歴
- 初期実装: HTML/CSS/JavaScriptによる基本機能
- モーダル実装: 7種類の招待方法対応
- 編集機能: フルスクリーン編集画面とデータ永続化
- イベント修正: 委譲方式による確実な3点リーダー動作
- UI改善: oplus準拠のデザイン調整
- シフト管理画面: カレンダー表示とタブナビゲーション実装
- レスポンシブ対応: 日・週・月表示の動的サイズ調整
- デザイン統一: ゴシック体フォント、フォントサイズ統一、管理者色分け
- フィルター機能: 出勤者のみフィルターとモーダル実装
- /ultrathink導入: 根本原因分析による確実な問題解決

## テスト方法
### スタッフ管理画面 (index.html)
1. ブラウザでindex.htmlを開く
2. F12でデベロッパーツールを開き、コンソールでログを確認
3. 各機能の動作確認:
   - スタッフ一覧の表示（管理者のシアン色表示確認）
   - ドラッグ&ドロップ
   - 追加ボタンのドロップダウン
   - 3点リーダーメニュー
   - 編集画面への遷移と保存
   - データの永続化確認

### シフト管理画面 (shift-management.html)
1. ブラウザでshift-management.htmlを開く
2. 各機能の動作確認:
   - カレンダー表示（今日の日付ハイライト確認）
   - 日・週・月表示切り替え（列幅変更確認）
   - フィルターボタンクリック → モーダル表示
   - 出勤者のみフィルター適用 → スタッフ数減少確認
   - カスタム期間選択モーダル
   - 内部スクロール機能
   - スタッフ管理との連携確認

### フィルター機能テスト
1. シフト管理画面でフィルターボタン（🔽）をクリック
2. 「出勤者のみ」チェック → 適用
3. スタッフリストが5名 → 3名に減少することを確認
4. カレンダーも対応するスタッフのみ表示されることを確認

## 注意事項
- 実際の動作確認を必ず行ってから修正完了を報告すること
- ユーザーからの「治っていない」指摘があった場合は、必ず実際のテストを実施
- /ultrathink で根本原因を特定してから修正に取り組む
- デバッグログを活用した問題特定を行う